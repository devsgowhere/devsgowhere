---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import FormattedEventDate from "../../components/FormattedEventDate.astro";

const orgs = await getCollection("orgs");

const now = new Date();
const events = (await getCollection("events"))
  .filter((event) => {
    const startDate = new Date(event.data.startDate);
    return startDate >= now;
  })
  .sort((a, b) => a.data.startDate.valueOf() - b.data.startDate.valueOf());
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main class="events-list-page">
      <div class="container">
        <section>
          <ul class="event-list">
            {
              events.map((event) => (
                <li class="event-list-item">
                  <a href={`/events/${event.id}/`}>
                    <Image
                      width={720}
                      height={360}
                      src={event.data.heroImage}
                      alt=""
                    />
                    <div class="event-list-item__info">
                      <div class="org-name text-gray-5 mb-2xs">
                        {
                          orgs.find((org) => org.id === event.data.org.id)?.data
                            .title
                        }
                      </div>
                      <div class="event-title text-3xl text-bold mb-xs">{event.data.title}</div>
                      <div class="event-date mb-m">
                        <i class="fa fa-calendar-days"></i>
                        <FormattedEventDate
                          startDate={event.data.startDate}
                          startTime={event.data.startTime}
                          endDate={event.data.endDate}
                          endTime={event.data.endTime}
                        />
                      </div>
                      <ul class="tag-list">
                        { event.data.tags?.map((tag)=>{
                          return (
                            <li class="tag">
                              #{tag}
                            </li>
                          )
                        }) }
                      </ul>
                    </div>
                  </a>
                </li>
              ))
            }
          </ul>
        </section>
      </div>
    </main>
    <Footer />
  </body>
</html>

<style lang="scss">

  .events-list-page {
    text-align: center;
  }

  ul.event-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  li.event-list-item a {

    $width: 720px;
    $border-color: rgba(134, 134, 134, 0.665);
    $border-color-hover: rgb(56, 25, 157);
    $shadow-color: rgba(175, 175, 175, 0.429);
    $shadow-color-hover: rgba(83, 70, 124, 0.599);

    // size
    max-width: $width;
    margin-top: 1rem;
    margin-bottom: 1rem;
    
    // layout
    display: inline-block;
  
    // color
    background-color: white;
    color: inherit;
    &:visited{
      color: inherit;
    }

    // border and shadow
    // - darken on hover
    border: 3px solid $border-color;
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 10px 10px 0 0 $shadow-color;
    &:hover {
      border-color: $border-color-hover;
      box-shadow: 10px 10px 0 0 $shadow-color-hover;
    }

    // text
    text-decoration: none;

    // image
    img {
      max-width: 100%;
      width: 720px;
      height: auto;
    }

    // event info block
    .event-list-item__info {
      padding: 1rem;
      text-align: left;
    }

  }

</style>
